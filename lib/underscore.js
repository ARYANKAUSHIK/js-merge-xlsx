"use strict";var _=require("underscore"),Mustache=require("mustache"),xml2js=require("xml2js"),builder=new xml2js.Builder;_.mixin({stringValue:function(e){return _.isArray(e)?(e=e[0],e._?e._:e):e},variables:function(e){return _.isString(e)?_.map(_.filter(Mustache.parse(e),function(e){return"&"===e[0]}),function(e){return e[1]}):null},hasVariable:function(e){return _.isString(e)&&0!==_.variables(e).length},deepCopy:function(e){if(!_.isObject(e))throw new Error("_.deepCopy() : argument should be object.");return JSON.parse(JSON.stringify(e))},deleteProps:function(e,n){var r=function(e,n){return _.reduce(e,function(e,r){return e.push(_.deleteProps(r,n)),e},[])};return _.isArray(e)?r(e,n):_.reduce(n,function(e,n){return delete e[n],e},e)},sum:function(e,n){return _.reduce(e,function(e,r){return e+n(r)},0)},count:function(e,n){return _.sum(e,function(e){return n(e)?1:0})},reverseEach:function(e,n){_.each(_.chain(e).reverse().value(),n)},reduceInReverse:function(e,n,r){return _.reduce(_.chain(e).reverse().value(),n,r)},nestedEach:function(e,n,r){_.each(e,function(e){_.each(n,function(n){r(e,n)})})},splice:function(e,n){return _.reduceInReverse(e,function(e,r,u){return n(r)&&e.splice(u,1),e},e)},containsAsPartialString:function(e,n){return _.reduce(e,function(e,r){return e||-1!==r.indexOf(n)},!1)},consistOf:function(e,n){return _.isArray(e)?_.reduce(e,function(e,r){return e&&_.consistOf(r,n)},!0):_.isString(n)?_.has(e,n):_.isArray(n)?_.reduce(n,function(n,r){return n&&_.consistOf(e,r)},!0):_.reduce(n,function(n,r,u){return n&&e[u]&&_.consistOf(e[u],r)},!0)},includeString:function(e,n){return-1!==e.indexOf(n)}});