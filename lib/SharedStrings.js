"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),_=require("underscore");require("./underscore_mixin");var SharedStrings=function(){function e(t,s){_classCallCheck(this,e),this.rawData=t,this.strings=t.sst.si,this.setUsingCells(this.getOnlyHavingVariable(),s)}return _createClass(e,[{key:"setUsingCells",value:function(e,t){_.each(e,function(e){e.usingCells=[],_.each(t,function(t){_.each(t.c,function(t){"s"===t.$.t&&e.sharedIndex===t.v[0]>>0&&e.usingCells.push(t.$.r)})})})}},{key:"add",value:function(e){var t=this,s=this.strings.length;_.each(e,function(e,n){e.sharedIndex=s+n,t.strings.push(e)})}},{key:"value",value:function(){return this.strings?(this.rawData.sst.si=_.deleteProperties(this.strings,["sharedIndex","usingCells"]),this.rawData.sst.$.uniqueCount=this.strings.length,this.rawData.sst.$.count=this.strings.length,this.rawData):null}},{key:"getOnlyHavingVariable",value:function(){var e=[];return _.each(this.strings,function(t,s){_.stringValue(t.t)&&_.hasVariable(_.stringValue(t.t))&&(t.sharedIndex=s,e.push(t))}),e}},{key:"hasString",value:function(){return!!this.strings}}]),e}();module.exports=SharedStrings;