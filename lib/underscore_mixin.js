"use strict";var _=require("underscore"),Mustache=require("mustache"),xml2js=require("xml2js"),builder=new xml2js.Builder;_.mixin({isString:function(r){return"string"==typeof r},stringValue:function(r){return _.isArray(r)?r[0]._?r[0]._:r[0]:r},variables:function(r){return _(r).isString()?_.map(_.filter(Mustache.parse(r),function(r){return"name"===r[0]}),function(r){return r[1]}):null},hasVariable:function(r){return _.isString(r)&&0!==_.variables(r).length},deepCopy:function(r){return JSON.parse(JSON.stringify(r))},deleteProperties:function(r,e){var n=_.isArray(r);return n||(r=[r]),_.each(r,function(r){return _.each(e,function(e){return delete r[e]})}),n?r:r[0]},decode:function(r){if(!r||"string"!=typeof r)return r;var e={"&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&amp;":"&"};return r.replace(/(&lt;|&gt;|&quot;|&#39;|&amp;)/g,function(r,n){return e[n]})},xml:function(r){return _.decode(builder.buildObject(r))},sum:function(r,e){return _.reduce(r,function(r,n){return e(n)},0)},count:function(r,e){return _.sum(r,function(r){return e(r)?1:0})}});