"use strict";var _=require("underscore"),Mustache=require("mustache"),xml2js=require("xml2js"),builder=new xml2js.Builder;_.mixin({isString:function(n){return"string"==typeof n},stringValue:function(n){return _.isArray(n)?n[0]._?n[0]._:n[0]:n},variables:function(n){return _(n).isString()?_.map(_.filter(Mustache.parse(n),function(n){return"name"===n[0]}),function(n){return n[1]}):null},hasVariable:function(n){return _.isString(n)&&0!==_.variables(n).length},deepCopy:function(n){return JSON.parse(JSON.stringify(n))},deleteProperties:function(n,e){var r=_.isArray(n);return r||(n=[n]),_.each(n,function(n){return _.each(e,function(e){return delete n[e]})}),r?n:n[0]},decode:function(n){if(!n||"string"!=typeof n)return n;var e={"&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&amp;":"&"};return n.replace(/(&lt;|&gt;|&quot;|&#39;|&amp;)/g,function(n,r){return e[r]})},xml:function(n){return _.decode(builder.buildObject(n))},sum:function(n,e){return _.reduce(n,function(n,r){return e(r)},0)},count:function(n,e){return _.sum(n,function(n){return e(n)?1:0})},reverseEach:function(n,e){_.each(_.sortBy(n,function(n,e){return-1*e}),e)},nestedEach:function(n,e,r){_.each(n,function(n){_.each(e,function(e){r(n,e)})})},splice:function(n,e){_.reverseEach(n,function(r,t){e(r)&&n.splice(t,1)})}});