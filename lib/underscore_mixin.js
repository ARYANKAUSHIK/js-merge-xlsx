"use strict";var _=require("underscore"),Mustache=require("mustache"),xml2js=require("xml2js"),builder=new xml2js.Builder;_.mixin({isString:function(n){return"string"==typeof n},stringValue:function(n){return _.isArray(n)?n[0]._?n[0]._:n[0]:n},variables:function(n){return _(n).isString()?_.map(n,function(n){return n[1]}):null},hasVariable:function(n){return _.isString(n)&&0!==_.variables(n).length},deepCopy:function(n){return JSON.parse(JSON.stringify(n))},deleteProperties:function(n,r){var e=_.isArray(n);return e||(n=[n]),_.each(n,function(n){return _.each(r,function(r){return delete n[r]})}),e?n:n[0]},sum:function(n,r){return _.reduce(n,function(n,e){return r(e)},0)},count:function(n,r){return _.sum(n,function(n){return r(n)?1:0})},reverseEach:function(n,r){_.each(_.sortBy(n,function(n,r){return-1*r}),r)},nestedEach:function(n,r,e){_.each(n,function(n){_.each(r,function(r){e(n,r)})})},splice:function(n,r){_.reverseEach(n,function(e,t){r(e)&&n.splice(t,1)})},containsAsPartialString:function(n,r){return _.reduce(n,function(n,e){return n||-1!==e.indexOf(r)},!1)}});